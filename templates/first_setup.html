{% extends "public_base.html" %}
{% set body_class = "public-shell--compact" %}
{% block title %}Première connexion - Planify{% endblock %}

{% block content %}
<div class="card public-hero">
    <h1>Planify</h1>
    <p>Configuration initiale — créez votre compte administrateur pour commencer.</p>
</div>

<div class="context-card">
    <div class="context-card-header">
        <div class="context-title">Étapes</div>
    </div>
    <div class="context-row"><span><i class="fas fa-user-shield"></i></span><strong>Créer le compte administrateur</strong></div>
    <div class="context-row"><span><i class="fas fa-building"></i></span><strong>Configurer les informations de l'entreprise</strong></div>
    <div class="context-row"><span><i class="fas fa-rocket"></i></span><strong>Commencer à utiliser Planify</strong></div>
</div>

{% with messages = get_flashed_messages(with_categories=true) %}
{% if messages %}
<div class="card">
    <div class="card-body">
        {% for category, message in messages %}
            <div class="alert alert-{{ category }}">{{ message|apply_terminology }}</div>
        {% endfor %}
    </div>
</div>
{% endif %}
{% endwith %}

<div class="card">
    <div class="card-body">
        <form method="POST" action="{{ url_for('first_setup') }}">
            <div class="form-group">
                <label class="form-label" for="nom">Nom complet *</label>
                <input type="text" id="nom" name="nom" class="form-control" required placeholder="Votre nom complet">
            </div>
            <div class="form-group">
                <label class="form-label" for="username">Nom d'utilisateur *</label>
                <input type="text" id="username" name="username" class="form-control" required placeholder="Nom d'utilisateur pour la connexion">
            </div>
            <div class="form-group">
                <label class="form-label" for="email">Email *</label>
                <input type="email" id="email" name="email" class="form-control" required placeholder="votre@email.com">
            </div>
            <div class="form-group">
                <label class="form-label" for="password">Mot de passe *</label>
                <input type="password" id="password" name="password" class="form-control" required placeholder="Mot de passe sécurisé" minlength="6">
            </div>
            <div class="form-group">
                <label class="form-label" for="confirm_password">Confirmer le mot de passe *</label>
                <input type="password" id="confirm_password" name="confirm_password" class="form-control" required placeholder="Confirmez votre mot de passe">
            </div>
            <button type="submit" class="btn btn-primary btn-full">
                <i class="fas fa-rocket"></i>
                Créer le compte administrateur
            </button>
        </form>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.querySelector('form').addEventListener('submit', function(e) {
        const password = document.getElementById('password').value;
        const confirmPassword = document.getElementById('confirm_password').value;

        if (password !== confirmPassword) {
            e.preventDefault();
            alert('Les mots de passe ne correspondent pas !');
            return false;
        }

        if (password.length < 6) {
            e.preventDefault();
            alert('Le mot de passe doit contenir au moins 6 caractères !');
            return false;
        }
    });
</script>
{% endblock %}
