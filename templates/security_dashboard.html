{% extends "base.html" %}

{% block title %}Tableau de bord de s√©curit√©{% endblock %}

{% block content %}
<div class="container">
    <h1>üîí Tableau de bord de s√©curit√©</h1>
    
    <div class="security-stats">
        <div class="stat-card">
            <h3>IPs bloqu√©es</h3>
            <p class="stat-number">{{ blocked_ips|length }}</p>
        </div>
        
        <div class="stat-card">
            <h3>Activit√©s suspectes</h3>
            <p class="stat-number">{{ suspicious_activities|length }}</p>
        </div>
        
        <div class="stat-card">
            <h3>Alertes</h3>
            <p class="stat-number">{{ alerts|length }}</p>
        </div>
    </div>
    
    <div class="security-sections">
        <div class="section">
            <h2>√âv√©nements r√©cents</h2>
            <div class="events-list">
                {% for event in events %}
                <div class="event-item">
                    <span class="event-time">{{ event.timestamp }}</span>
                    <span class="event-type">{{ event.event_type }}</span>
                    <span class="event-details">{{ event.data }}</span>
                </div>
                {% endfor %}
            </div>
        </div>
        
        <div class="section">
            <h2>IPs bloqu√©es</h2>
            <div class="blocked-ips">
                {% for ip in blocked_ips %}
                <div class="ip-item">
                    <span class="ip-address">{{ ip }}</span>
                    <button onclick="unblockIP('{{ ip }}')" class="btn btn-sm">D√©bloquer</button>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>

<script>
function unblockIP(ip) {
    if (confirm('D√©bloquer l\'IP ' + ip + '?')) {
        fetch('/security/unblock-ip/' + ip, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.message) {
                alert(data.message);
                location.reload();
            }
        });
    }
}
</script>

<style>
.security-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
    margin: 2rem 0;
}

.stat-card {
    background: #f8f9fa;
    padding: 1.5rem;
    border-radius: 8px;
    text-align: center;
    border: 1px solid #dee2e6;
}

.stat-number {
    font-size: 2rem;
    font-weight: bold;
    color: #dc3545;
    margin: 0.5rem 0;
}

.security-sections {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 2rem;
    margin: 2rem 0;
}

.section {
    background: #f8f9fa;
    padding: 1.5rem;
    border-radius: 8px;
    border: 1px solid #dee2e6;
}

.events-list, .blocked-ips {
    max-height: 400px;
    overflow-y: auto;
}

.event-item, .ip-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.5rem;
    border-bottom: 1px solid #dee2e6;
}

.event-time, .ip-address {
    font-family: monospace;
    font-size: 0.9rem;
}

.event-type {
    font-weight: bold;
    color: #007bff;
}

.btn {
    padding: 0.25rem 0.5rem;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 0.8rem;
}

.btn-sm {
    padding: 0.2rem 0.4rem;
    font-size: 0.75rem;
}
</style>
{% endblock %}
